<div class="page-container">
  <div class="menu" (click)="openMenu()">â‹®</div>

  <div class="overlay" [class.active]="activeMenu" (click)="closeMenu()"></div>

  <div class="side-menu" [class.active]="activeMenu">
    <div class="menu-header">
      <h1 i18n>Menu</h1>
    </div>
    <ul class="menu-items">
      <li><button class="menu-item" [routerLink]="['/profile']" i18n>Perfil</button></li>
      <li><button class="menu-item" [routerLink]="['/create-recipe']" i18n>Criar Prato</button></li>
      <li><button class="menu-item" [routerLink]="['/saved-recipes']" i18n>Pratos Salvos</button></li>
      <li><button class="menu-item" i18n>ConfiguraÃ§Ãµes</button></li>
      <li><button class="menu-item" [routerLink]="['/sign-in']" i18n>Sair</button></li>
    </ul>
  </div>

  @if (showInstallPrompt) {
  <div class="install-prompt">
    <p i18n>Instalar DieTI no seu dispositivo?</p>
    <button (click)="installApp()" class="btn-install" i18n>Instalar</button>
    <button (click)="showInstallPrompt = false" class="btn-dismiss">Ã—</button>
  </div>
  }

  <img src="assets/images/logo.svg" alt="Dieti" class="logo-image" />

  @if (!isOnline) {
  <div class="offline-banner" i18n>
    ðŸ“´ Offline: Alimentos serÃ£o sincronizados depois
  </div>
  }

  <div class="input-group">
    <div class="input-food">
      <input
        #foodInput
        i18n
        name="food"
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
        (blur)="onBlur()"
        (focus)="showResults()"
        (keydown)="onKeyDown($event)"
        class="input-field"
        placeholder="Pesquisar alimento..."
      />

      @if (searchResults.length > 0) {
      <div class="search-results" #searchResultsContainer>
        @for (food of searchResults; track food._id) {
        <div
          #searchItem
          class="search-item"
          (pointerdown)="onResultPointerDown($event)"
          (click)="onResultClick(food, $event)"
          [class.active]="$index === selectedItemIndex"
        >
          <div class="food-name">
            {{ formatFoodDescription(food.description).mainName }}
          </div>

          @if (formatFoodDescription(food.description).details.length > 0) {
          <div class="food-details">
            @for (detail of formatFoodDescription(food.description).details; track $index) {
            <span class="detail">{{ detail }}</span>
            }
          </div>
          }

          @if (food.type === 'recipe') {
          <span class="tag" i18n>Prato</span>
          }
        </div>
        }
      </div>
      }
    </div>

    <div class="dual-button">
      <div class="slider" [style.left]="sliderPosition"></div>
      <button class="button-left" tabindex="1" (click)="moveSlider('left')" #buttonLeft>
        @if (isLeftActive) {
        <img src="assets/images/chart_daily_active.svg" alt="daily_chart" class="chart" />
        } @else {
        <img src="assets/images/chart_daily.svg" alt="daily_chart" class="chart" />
        }
      </button>
      <button class="button-right" tabindex="2" (click)="moveSlider('right')">
        @if (isLeftActive) {
        <img src="assets/images/chart_period.svg" alt="period_chart" class="chart" />
        } @else {
        <img src="assets/images/chart_period_active.svg" alt="period_chart" class="chart" />
        }
      </button>
    </div>
  </div>

  @if (popupVisible) {
  <div class="popup-overlay">
    <div class="popup">
      <h3>
        @if (selectedFood) { {{ selectedFood.description }} } @else { {{ selectedRecipe?.name }} }
      </h3>
      <label i18n>
        Gramas:
        <input type="number" [(ngModel)]="grams" min="1" />
      </label>
      <div class="popup-actions">
        <button (click)="addFood()" class="btn-primary" i18n>Adicionar</button>
        <button (click)="closePopup()" class="btn-cancel" i18n>Cancelar</button>
      </div>
    </div>
  </div>
  }

  <div class="progress-container">
    <app-multi-ring-chart
      [style.display]="isLeftActive ? 'block' : 'none'"
      [calorias]="caloriasData"
      [proteinas]="proteinasData"
      [carb]="carbData"
      [gordura]="gorduraData"
      (refreshData)="onDataChanged()"
      class="multi-ring-chart"
    ></app-multi-ring-chart>

    @if (favoriteRecipes && favoriteRecipes.length > 0) {
    <div class="favorites-container" [style.display]="isLeftActive ? 'block' : 'none'">
      <h4 [routerLink]="['/saved-recipes']" i18n>Favoritos</h4>
      <div class="favorites-scroll">
        @for (recipe of favoriteRecipes; track recipe._id) {
        <div class="favorite-item" (click)="selectFavoriteRecipe(recipe); $event.stopPropagation()">
          {{ recipe.name }}
        </div>
        }
      </div>
    </div>
    }

    <app-line-chart
      class="line-chart"
      [goals]="goals"
      [style.display]="!isLeftActive ? 'block' : 'none'"
    ></app-line-chart>
  </div>
</div>
